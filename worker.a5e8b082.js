parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"PTIi":[function(require,module,exports) {
var define;
var global = arguments[3];
var r,t=arguments[3];!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof r&&r.amd?r(e):t.MemoryMap=e()}(this,function(){"use strict";var r=/:([0-9A-Fa-f]{8,})([0-9A-Fa-f]{2})(?:\r\n|\r|\n|)/g;function t(r){return 255&-r.reduce(function(r,t){return r+t},0)}function e(r){return r.toString(16).toUpperCase().padStart(2,"0")}Number.isInteger=Number.isInteger||function(r){return"number"==typeof r&&isFinite(r)&&Math.floor(r)===r};var o=function(r){if(this._blocks=new Map,r&&"function"==typeof r[Symbol.iterator])for(var t of r){if(!(t instanceof Array)||2!==t.length)throw new Error("First parameter to MemoryMap constructor must be an iterable of [addr, bytes] or undefined");this.set(t[0],t[1])}else if("object"==typeof r){var e=Object.keys(r);for(var o of e)this.set(parseInt(o),r[o])}else if(null!=r)throw new Error("First parameter to MemoryMap constructor must be an iterable of [addr, bytes] or undefined")},n={size:{configurable:!0}};return o.prototype.set=function(r,t){if(!Number.isInteger(r))throw new Error("Address passed to MemoryMap is not an integer");if(r<0)throw new Error("Address passed to MemoryMap is negative");if(!(t instanceof Uint8Array))throw new Error("Bytes passed to MemoryMap are not an Uint8Array");return this._blocks.set(r,t)},o.prototype.get=function(r){return this._blocks.get(r)},o.prototype.clear=function(){return this._blocks.clear()},o.prototype.delete=function(r){return this._blocks.delete(r)},o.prototype.entries=function(){return this._blocks.entries()},o.prototype.forEach=function(r,t){return this._blocks.forEach(r,t)},o.prototype.has=function(r){return this._blocks.has(r)},o.prototype.keys=function(){return this._blocks.keys()},o.prototype.values=function(){return this._blocks.values()},n.size.get=function(){return this._blocks.size},o.prototype[Symbol.iterator]=function(){return this._blocks[Symbol.iterator]()},o.fromHex=function(n,a){void 0===a&&(a=1/0);var i,s=new o,f=0,u=0,h=0;for(r.lastIndex=0;null!==(i=r.exec(n));){if(u++,f!==i.index)throw new Error("Malformed hex file: Could not parse between characters "+f+" and "+i.index+' ("'+n.substring(f,Math.min(i.index,f+16)).trim()+'")');f=r.lastIndex;var c=i[1],l=i[2],d=new Uint8Array(c.match(/[\da-f]{2}/gi).map(function(r){return parseInt(r,16)})),p=d[0];if(p+4!==d.length)throw new Error("Mismatched record length at record "+u+" ("+i[0].trim()+"), expected "+p+" data bytes but actual length is "+(d.length-4));var y=t(d);if(parseInt(l,16)!==y)throw new Error("Checksum failed at record "+u+" ("+i[0].trim()+"), should be "+y.toString(16));var v=(d[1]<<8)+d[2],w=d[3],g=d.subarray(4);if(0===w){if(s.has(h+v))throw new Error("Duplicated data at record "+u+" ("+i[0].trim()+")");if(v+g.length>65536)throw new Error("Data at record "+u+" ("+i[0].trim()+") wraps over 0xFFFF. This would trigger ambiguous behaviour. Please restructure your data so that for every record the data offset plus the data length do not exceed 0xFFFF.");s.set(h+v,g)}else{if(0!==v)throw new Error("Record "+u+" ("+i[0].trim()+") must have 0000 as data offset.");switch(w){case 1:if(f!==n.length)throw new Error("There is data after an EOF record at record "+u);return s.join(a);case 2:h=(g[0]<<8)+g[1]<<4;break;case 3:break;case 4:h=(g[0]<<8)+g[1]<<16;break;case 5:break;default:throw new Error("Invalid record type 0x"+e(w)+" at record "+u+" (should be between 0x00 and 0x05)")}}}throw u?new Error("No EOF record at end of file"):new Error("Malformed .hex file, could not parse any registers")},o.prototype.join=function(r){void 0===r&&(r=1/0);for(var t=Array.from(this.keys()).sort(function(r,t){return r-t}),e=new Map,n=-1,a=-1,i=0,s=t.length;i<s;i++){var f=t[i],u=this.get(t[i]).length;if(a===f&&a-n<r)e.set(n,e.get(n)+u),a+=u;else{if(!(a<=f))throw new Error("Overlapping data around address 0x"+f.toString(16));e.set(f,u),n=f,a=f+u}}for(var h,c=new o,l=-1,d=0,p=t.length;d<p;d++){var y=t[d];e.has(y)&&(h=new Uint8Array(e.get(y)),c.set(y,h),l=y),h.set(this.get(y),y-l)}return c},o.overlapMemoryMaps=function(r){var t=new Set;for(var[,e]of r)for(var[o,n]of e)t.add(o),t.add(o+n.length);for(var a=Array.from(t.values()).sort(function(r,t){return r-t}),i=new Map,s=function(t,e){var o=a[t],n=a[t+1],s=[];for(var[f,u]of r){var h=Array.from(u.keys()).reduce(function(r,t){return t>o?r:Math.max(r,t)},-1);if(-1!==h){var c=u.get(h),l=o-h,d=n-h;l<c.length&&s.push([f,c.subarray(l,d)])}}s.length&&i.set(o,s)},f=0,u=a.length-1;f<u;f++)s(f);return i},o.flattenOverlaps=function(r){return new o(Array.from(r.entries()).map(function(r){var t=r[0],e=r[1];return[t,e[e.length-1][1]]}))},o.prototype.paginate=function(r,t){if(void 0===r&&(r=1024),void 0===t&&(t=255),r<=0)throw new Error("Page size must be greater than zero");for(var e,n=new o,a=Array.from(this.keys()).sort(function(r,t){return r-t}),i=0,s=a.length;i<s;i++)for(var f=a[i],u=this.get(f),h=u.length,c=f+h,l=f-f%r;l<c;l+=r){(e=n.get(l))||((e=new Uint8Array(r)).fill(t),n.set(l,e));var d=l-f,p=void 0;d<=0?(p=u.subarray(0,Math.min(r+d,h)),e.set(p,-d)):(p=u.subarray(d,d+Math.min(r,h-d)),e.set(p,0))}return n},o.prototype.getUint32=function(r,t){for(var e=Array.from(this.keys()),o=0,n=e.length;o<n;o++){var a=e[o],i=this.get(a),s=i.length;if(a<=r&&r+4<=a+s)return new DataView(i.buffer,r-a,4).getUint32(0,t)}},o.prototype.asHexString=function(r){void 0===r&&(r=16);var o=0,n=-65536,a=[];if(r<=0)throw new Error("Size of record must be greater than zero");if(r>255)throw new Error("Size of record must be less than 256");for(var i,s=new Uint8Array(6),f=new Uint8Array(4),u=Array.from(this.keys()).sort(function(r,t){return r-t}),h=0,c=u.length;h<c;h++){var l=u[h],d=this.get(l);if(!(d instanceof Uint8Array))throw new Error("Block at offset "+l+" is not an Uint8Array");if(l<0)throw new Error("Block at offset "+l+" has a negative thus invalid address");var p=d.length;if(p){if(l>n+65535&&(n=l-l%65536,o=0,s[0]=2,s[1]=0,s[2]=0,s[3]=4,s[4]=n>>24,s[5]=n>>16,a.push(":"+Array.prototype.map.call(s,e).join("")+e(t(s)))),l<n+o)throw new Error("Block starting at 0x"+l.toString(16)+" overlaps with a previous block.");o=l%65536;var y=0,v=l+p;if(v>4294967295)throw new Error("Data cannot be over 0xFFFFFFFF");for(;n+o<v;){o>65535&&(n+=65536,o=0,s[0]=2,s[1]=0,s[2]=0,s[3]=4,s[4]=n>>24,s[5]=n>>16,a.push(":"+Array.prototype.map.call(s,e).join("")+e(t(s))));for(var w=-1;o<65536&&w;)if(w=Math.min(r,v-n-o,65536-o)){f[0]=w,f[1]=o>>8,f[2]=o,f[3]=0;var g=d.subarray(y,y+w);a.push(":"+Array.prototype.map.call(f,e).join("")+Array.prototype.map.call(g,e).join("")+e((i=g,255&-(f.reduce(function(r,t){return r+t},0)+i.reduce(function(r,t){return r+t},0))))),y+=w,o+=w}}}}return a.push(":00000001FF"),a.join("\n")},o.prototype.clone=function(){var r=new o;for(var[t,e]of this)r.set(t,new Uint8Array(e));return r},o.fromPaddedUint8Array=function(r,t,e){if(void 0===t&&(t=255),void 0===e&&(e=64),!(r instanceof Uint8Array))throw new Error("Bytes passed to fromPaddedUint8Array are not an Uint8Array");for(var n=new o,a=0,i=-1,s=0,f=!1,u=r.length,h=0;h<u;h++){r[h]===t?++a>=e&&(-1!==i&&n.set(s,r.subarray(s,i+1)),f=!0):(f&&(f=!1,s=h),i=h,a=0)}return f||-1===i||n.set(s,r.subarray(s,u)),n},o.prototype.slice=function(r,t){if(void 0===t&&(t=1/0),t<0)throw new Error("Length of the slice cannot be negative");var e=new o;for(var[n,a]of this){var i=a.length;if(n+i>=r&&n<r+t){var s=Math.max(r,n),f=Math.min(r+t,n+i)-s,u=s-n;f>0&&e.set(s,a.subarray(u,u+f))}}return e},o.prototype.slicePad=function(r,t,e){if(void 0===e&&(e=255),t<0)throw new Error("Length of the slice cannot be negative");var o=new Uint8Array(t).fill(e);for(var[n,a]of this){var i=a.length;if(n+i>=r&&n<r+t){var s=Math.max(r,n),f=Math.min(r+t,n+i)-s,u=s-n;f>0&&o.set(a.subarray(u,u+f),s-r)}}return o},o.prototype.contains=function(r){for(var[t,e]of r){var o=e.length,n=this.slice(t,o).join().get(t);if(!n||n.length!==o)return!1;for(var a in e)if(e[a]!==n[a])return!1}return!0},Object.defineProperties(o.prototype,n),o});
},{}],"hTHz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.debounce=exports.throttle=void 0;const e=(e,t,o)=>{let r=!1;return()=>{r||(o||e(),r=!0,setTimeout(()=>{r=!1,o&&e()},t))}};exports.throttle=e;const t=(e,t)=>{let o=0;return()=>{clearTimeout(o),o=setTimeout(()=>e(),t)}};exports.debounce=t;
},{}],"j7IA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cycle_counts_dd=exports.cycle_counts_cb=exports.cycle_counts_ed=exports.cycle_counts=exports.parity_bits=void 0;const c=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1];exports.parity_bits=c;const t=[4,10,7,6,4,4,7,4,4,11,7,6,4,4,7,4,8,10,7,6,4,4,7,4,12,11,7,6,4,4,7,4,7,10,16,6,4,4,7,4,7,11,16,6,4,4,7,4,7,10,13,6,11,11,10,4,7,11,13,6,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,7,7,7,7,7,7,4,7,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,5,10,10,10,10,11,7,11,5,10,10,0,10,17,7,11,5,10,10,11,10,11,7,11,5,4,10,11,10,0,7,11,5,10,10,19,10,11,7,11,5,4,10,4,10,0,7,11,5,10,10,4,10,11,7,11,5,6,10,4,10,0,7,11];exports.cycle_counts=t;const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,18,12,12,15,20,8,14,8,18,12,12,15,20,8,14,8,0,12,12,15,20,8,14,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,16,16,0,0,0,0,16,16,16,16,0,0,0,0,16,16,16,16,0,0,0,0,16,16,16,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];exports.cycle_counts_ed=e;const s=[8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8];exports.cycle_counts_cb=s;const o=[0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0,0,14,20,10,8,8,11,0,0,15,20,10,8,8,11,0,0,0,0,0,23,23,19,0,0,15,0,0,0,0,0,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,8,8,8,8,8,8,19,8,8,8,8,8,8,8,19,8,19,19,19,19,19,19,0,19,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,0,23,0,15,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0];exports.cycle_counts_dd=o;
},{}],"jIr1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=s,exports.interrupt=exports.execute=exports.reset=void 0;var e=require("./z80-constants");const a=(e,a)=>{e.flags.S=(128&a)>>>7,e.flags.Z=(64&a)>>>6,e.flags.Y=(32&a)>>>5,e.flags.H=(16&a)>>>4,e.flags.X=(8&a)>>>3,e.flags.P=(4&a)>>>2,e.flags.N=(2&a)>>>1,e.flags.C=1&a},c=(e,a,c)=>{e.sp=e.sp-1&65535,a.mem_write(e.sp,(65280&c)>>>8),e.sp=e.sp-1&65535,a.mem_write(e.sp,255&c)},l=(l,s,m)=>{const p=e=>(128&(e&=255)&&(e=-(1+(255&~e))),e),f=()=>l.flags.S<<7|l.flags.Z<<6|l.flags.Y<<5|l.flags.H<<4|l.flags.X<<3|l.flags.P<<2|l.flags.N<<1|l.flags.C,r=e=>{l.flags.Y=(32&e)>>>5,l.flags.X=(8&e)>>>3},i=()=>{let e=255&s.mem_read(l.sp);return l.sp=l.sp+1&65535,e|=s.mem_read(l.sp)<<8,l.sp=l.sp+1&65535,e},_=e=>{e?(l.pc=s.mem_read(l.pc+1&65535)|s.mem_read(l.pc+2&65535)<<8,l.pc=l.pc-1&65535):l.pc=l.pc+2&65535},g=e=>{if(e){l.cycle_counter+=5;const e=p(s.mem_read(l.pc+1&65535));l.pc=l.pc+e+1&65535}else l.pc=l.pc+1&65535},t=e=>{e?(l.cycle_counter+=7,c(l,s,l.pc+3&65535),l.pc=s.mem_read(l.pc+1&65535)|s.mem_read(l.pc+2&65535)<<8,l.pc=l.pc-1&65535):l.pc=l.pc+2&65535},d=e=>{e&&(l.cycle_counter+=6,l.pc=i()-1&65535)},o=e=>{c(l,s,l.pc+1&65535),l.pc=e-1&65535},x=e=>{const a=l.a+e;l.flags.S=128&a?1:0,l.flags.Z=255&a?0:1,l.flags.H=(15&e)+(15&l.a)&16?1:0,l.flags.P=(128&l.a)==(128&e)&&(128&l.a)!=(128&a)?1:0,l.flags.N=0,l.flags.C=256&a?1:0,l.a=255&a,r(l.a)},n=e=>{const a=l.a+e+l.flags.C;l.flags.S=128&a?1:0,l.flags.Z=255&a?0:1,l.flags.H=(15&e)+(15&l.a)+l.flags.C&16?1:0,l.flags.P=(128&l.a)==(128&e)&&(128&l.a)!=(128&a)?1:0,l.flags.N=0,l.flags.C=256&a?1:0,l.a=255&a,r(l.a)},b=e=>{const a=l.a-e;l.flags.S=128&a?1:0,l.flags.Z=255&a?0:1,l.flags.H=(15&l.a)-(15&e)&16?1:0,l.flags.P=(128&l.a)!=(128&e)&&(128&l.a)!=(128&a)?1:0,l.flags.N=1,l.flags.C=256&a?1:0,l.a=255&a,r(l.a)},h=e=>{const a=l.a-e-l.flags.C;l.flags.S=128&a?1:0,l.flags.Z=255&a?0:1,l.flags.H=(15&l.a)-(15&e)-l.flags.C&16?1:0,l.flags.P=(128&l.a)!=(128&e)&&(128&l.a)!=(128&a)?1:0,l.flags.N=1,l.flags.C=256&a?1:0,l.a=255&a,r(l.a)},y=e=>{const a=l.a;b(e),l.a=a,r(e)},Z=a=>{l.a&=255&a,l.flags.S=128&l.a?1:0,l.flags.Z=l.a?0:1,l.flags.H=1,l.flags.P=e.parity_bits[l.a],l.flags.N=0,l.flags.C=0,r(l.a)},w=a=>{l.a=255&(a|l.a),l.flags.S=128&l.a?1:0,l.flags.Z=l.a?0:1,l.flags.H=0,l.flags.P=e.parity_bits[l.a],l.flags.N=0,l.flags.C=0,r(l.a)},C=a=>{l.a=255&(a^l.a),l.flags.S=128&l.a?1:0,l.flags.Z=l.a?0:1,l.flags.H=0,l.flags.P=e.parity_bits[l.a],l.flags.N=0,l.flags.C=0,r(l.a)},u=e=>{let a=e+1;return l.flags.S=128&a?1:0,l.flags.Z=255&a?0:1,l.flags.H=15==(15&e)?1:0,l.flags.P=127===e?1:0,l.flags.N=0,r(a&=255),a},P=e=>{let a=e-1;return l.flags.S=128&a?1:0,l.flags.Z=255&a?0:1,l.flags.H=0==(15&e)?1:0,l.flags.P=128===e?1:0,l.flags.N=1,r(a&=255),a},S=e=>{const a=l.l|l.h<<8,c=a+e;l.flags.N=0,l.flags.C=65536&c?1:0,l.flags.H=(4095&a)+(4095&e)&4096?1:0,l.l=255&c,l.h=(65280&c)>>>8,r(l.h)},H=e=>{e+=l.flags.C;const a=l.l|l.h<<8,c=a+e;l.flags.S=32768&c?1:0,l.flags.Z=65535&c?0:1,l.flags.H=(4095&a)+(4095&e)&4096?1:0,l.flags.P=(32768&a)==(32768&e)&&(32768&c)!=(32768&a)?1:0,l.flags.N=0,l.flags.C=65536&c?1:0,l.l=255&c,l.h=c>>>8&255,r(l.h)},N=e=>{e+=l.flags.C;const a=l.l|l.h<<8,c=a-e;l.flags.S=32768&c?1:0,l.flags.Z=65535&c?0:1,l.flags.H=(4095&a)-(4095&e)&4096?1:0,l.flags.P=(32768&a)!=(32768&e)&&(32768&c)!=(32768&a)?1:0,l.flags.N=1,l.flags.C=65536&c?1:0,l.l=255&c,l.h=c>>>8&255,r(l.h)},X=a=>{const c=s.io_read(a);return l.flags.S=128&c?1:0,l.flags.Z=c?0:1,l.flags.H=0,l.flags.P=e.parity_bits[c]?1:0,l.flags.N=0,r(c),c},Y=()=>{128!==l.a&&(l.a=p(l.a),l.a=255&-l.a),l.flags.S=128&l.a?1:0,l.flags.Z=l.a?0:1,l.flags.H=(15&-l.a)>0?1:0,l.flags.P=128===l.a?1:0,l.flags.N=1,l.flags.C=l.a?1:0,r(l.a)},v=()=>{const e=s.mem_read(l.l|l.h<<8);s.mem_write(l.e|l.d<<8,e);let a=1+(l.e|l.d<<8);l.e=255&a,l.d=(65280&a)>>>8,a=1+(l.l|l.h<<8),l.l=255&a,l.h=(65280&a)>>>8,a=(l.c|l.b<<8)-1,l.c=255&a,l.b=(65280&a)>>>8,l.flags.H=0,l.flags.P=l.c||l.b?1:0,l.flags.N=0,l.flags.Y=(l.a+e&2)>>>1,l.flags.X=(l.a+e&8)>>>3},j=()=>{const e=l.flags.C,a=s.mem_read(l.l|l.h<<8);y(a),l.flags.C=e,l.flags.Y=(l.a-a-l.flags.H&2)>>>1,l.flags.X=(l.a-a-l.flags.H&8)>>>3;let c=1+(l.l|l.h<<8);l.l=255&c,l.h=(65280&c)>>>8,c=(l.c|l.b<<8)-1,l.c=255&c,l.b=(65280&c)>>>8,l.flags.P=c?1:0},q=()=>{l.b=P(l.b),s.mem_write(l.l|l.h<<8,s.io_read(l.b<<8|l.c));const e=1+(l.l|l.h<<8);l.l=255&e,l.h=(65280&e)>>>8,l.flags.N=1},z=()=>{s.io_write(l.b<<8|l.c,s.mem_read(l.l|l.h<<8));const e=1+(l.l|l.h<<8);l.l=255&e,l.h=(65280&e)>>>8,l.b=P(l.b),l.flags.N=1},M=()=>{l.flags.N=0,l.flags.H=0;const e=s.mem_read(l.l|l.h<<8);s.mem_write(l.e|l.d<<8,e);let a=(l.e|l.d<<8)-1;l.e=255&a,l.d=(65280&a)>>>8,a=(l.l|l.h<<8)-1,l.l=255&a,l.h=(65280&a)>>>8,a=(l.c|l.b<<8)-1,l.c=255&a,l.b=(65280&a)>>>8,l.flags.P=l.c||l.b?1:0,l.flags.Y=(l.a+e&2)>>>1,l.flags.X=(l.a+e&8)>>>3},O=()=>{const e=l.flags.C,a=s.mem_read(l.l|l.h<<8);y(a),l.flags.C=e,l.flags.Y=(l.a-a-l.flags.H&2)>>>1,l.flags.X=(l.a-a-l.flags.H&8)>>>3;let c=(l.l|l.h<<8)-1;l.l=255&c,l.h=(65280&c)>>>8,c=(l.c|l.b<<8)-1,l.c=255&c,l.b=(65280&c)>>>8,l.flags.P=c?1:0},k=()=>{l.b=P(l.b),s.mem_write(l.l|l.h<<8,s.io_read(l.b<<8|l.c));const e=(l.l|l.h<<8)-1;l.l=255&e,l.h=(65280&e)>>>8,l.flags.N=1},A=()=>{s.io_write(l.b<<8|l.c,s.mem_read(l.l|l.h<<8));const e=(l.l|l.h<<8)-1;l.l=255&e,l.h=(65280&e)>>>8,l.b=P(l.b),l.flags.N=1},B=a=>(l.flags.N=0,l.flags.H=0,l.flags.C=(128&a)>>>7,a=255&(a<<1|l.flags.C),l.flags.Z=a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=128&a?1:0,r(a),a),D=a=>(l.flags.N=0,l.flags.H=0,l.flags.C=1&a,a=a>>>1&127|l.flags.C<<7,l.flags.Z=255&a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=128&a?1:0,r(a),255&a),E=a=>{l.flags.N=0,l.flags.H=0;const c=l.flags.C;return l.flags.C=(128&a)>>>7,a=255&(a<<1|c),l.flags.Z=a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=128&a?1:0,r(a),a},F=a=>{l.flags.N=0,l.flags.H=0;const c=l.flags.C;return l.flags.C=1&a,a=a>>>1&127|c<<7,l.flags.Z=a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=128&a?1:0,r(a),a},G=a=>(l.flags.N=0,l.flags.H=0,l.flags.C=(128&a)>>>7,a=a<<1&255,l.flags.Z=a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=128&a?1:0,r(a),a),I=a=>(l.flags.N=0,l.flags.H=0,l.flags.C=1&a,a=a>>>1&127|128&a,l.flags.Z=a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=128&a?1:0,r(a),a),J=a=>(l.flags.N=0,l.flags.H=0,l.flags.C=(128&a)>>>7,a=a<<1&255|1,l.flags.Z=a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=128&a?1:0,r(a),a),K=a=>(l.flags.N=0,l.flags.H=0,l.flags.C=1&a,a=a>>>1&127,l.flags.Z=a?0:1,l.flags.P=e.parity_bits[a],l.flags.S=0,r(a),a),L=e=>{l.flags.N=0;const a=l.ix+e;l.flags.C=65536&a?1:0,l.flags.H=(4095&l.ix)+(4095&e)&4096?1:0,r((65280&a)>>>8),l.ix=a},Q=[];Q[9]=(()=>{L(l.c|l.b<<8)}),Q[25]=(()=>{L(l.e|l.d<<8)}),Q[33]=(()=>{l.pc=l.pc+1&65535,l.ix=s.mem_read(l.pc),l.pc=l.pc+1&65535,l.ix|=s.mem_read(l.pc)<<8}),Q[34]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,s.mem_write(e,255&l.ix),s.mem_write(e+1&65535,l.ix>>>8&255)}),Q[35]=(()=>{l.ix=l.ix+1&65535}),Q[36]=(()=>{l.ix=u(l.ix>>>8)<<8|255&l.ix}),Q[37]=(()=>{l.ix=P(l.ix>>>8)<<8|255&l.ix}),Q[38]=(()=>{l.pc=l.pc+1&65535,l.ix=s.mem_read(l.pc)<<8|255&l.ix}),Q[41]=(()=>{L(l.ix)}),Q[42]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,l.ix=s.mem_read(e),l.ix|=s.mem_read(e+1&65535)<<8}),Q[43]=(()=>{l.ix=l.ix-1&65535}),Q[44]=(()=>{l.ix=u(255&l.ix)|65280&l.ix}),Q[45]=(()=>{l.ix=P(255&l.ix)|65280&l.ix}),Q[46]=(()=>{l.pc=l.pc+1&65535,l.ix=255&s.mem_read(l.pc)|65280&l.ix}),Q[52]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc)),a=s.mem_read(e+l.ix&65535);s.mem_write(e+l.ix&65535,u(a))}),Q[53]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc)),a=s.mem_read(e+l.ix&65535);s.mem_write(e+l.ix&65535,P(a))}),Q[54]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.pc=l.pc+1&65535,s.mem_write(l.ix+e&65535,s.mem_read(l.pc))}),Q[57]=(()=>{L(l.sp)}),Q[68]=(()=>{l.b=l.ix>>>8&255}),Q[69]=(()=>{l.b=255&l.ix}),Q[70]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.b=s.mem_read(l.ix+e&65535)}),Q[76]=(()=>{l.c=l.ix>>>8&255}),Q[77]=(()=>{l.c=255&l.ix}),Q[78]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.c=s.mem_read(l.ix+e&65535)}),Q[84]=(()=>{l.d=l.ix>>>8&255}),Q[85]=(()=>{l.d=255&l.ix}),Q[86]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.d=s.mem_read(l.ix+e&65535)}),Q[92]=(()=>{l.e=l.ix>>>8&255}),Q[93]=(()=>{l.e=255&l.ix}),Q[94]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.e=s.mem_read(l.ix+e&65535)}),Q[96]=(()=>{l.ix=255&l.ix|l.b<<8}),Q[97]=(()=>{l.ix=255&l.ix|l.c<<8}),Q[98]=(()=>{l.ix=255&l.ix|l.d<<8}),Q[99]=(()=>{l.ix=255&l.ix|l.e<<8}),Q[100]=(()=>{}),Q[101]=(()=>{l.ix=255&l.ix|(255&l.ix)<<8}),Q[102]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.h=s.mem_read(l.ix+e&65535)}),Q[103]=(()=>{l.ix=255&l.ix|l.a<<8}),Q[104]=(()=>{l.ix=65280&l.ix|l.b}),Q[105]=(()=>{l.ix=65280&l.ix|l.c}),Q[106]=(()=>{l.ix=65280&l.ix|l.d}),Q[107]=(()=>{l.ix=65280&l.ix|l.e}),Q[108]=(()=>{l.ix=65280&l.ix|l.ix>>>8}),Q[109]=(()=>{}),Q[110]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.l=s.mem_read(l.ix+e&65535)}),Q[111]=(()=>{l.ix=65280&l.ix|l.a}),Q[112]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));s.mem_write(l.ix+e&65535,l.b)}),Q[113]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));s.mem_write(l.ix+e&65535,l.c)}),Q[114]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));s.mem_write(l.ix+e&65535,l.d)}),Q[115]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));s.mem_write(l.ix+e&65535,l.e)}),Q[116]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));s.mem_write(l.ix+e&65535,l.h)}),Q[117]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));s.mem_write(l.ix+e&65535,l.l)}),Q[119]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));s.mem_write(l.ix+e&65535,l.a)}),Q[124]=(()=>{l.a=l.ix>>>8&255}),Q[125]=(()=>{l.a=255&l.ix}),Q[126]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));l.a=s.mem_read(l.ix+e&65535)}),Q[132]=(()=>{x(l.ix>>>8&255)}),Q[133]=(()=>{x(255&l.ix)}),Q[134]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));x(s.mem_read(l.ix+e&65535))}),Q[140]=(()=>{n(l.ix>>>8&255)}),Q[141]=(()=>{n(255&l.ix)}),Q[142]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));n(s.mem_read(l.ix+e&65535))}),Q[148]=(()=>{b(l.ix>>>8&255)}),Q[149]=(()=>{b(255&l.ix)}),Q[150]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));b(s.mem_read(l.ix+e&65535))}),Q[156]=(()=>{h(l.ix>>>8&255)}),Q[157]=(()=>{h(255&l.ix)}),Q[158]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));h(s.mem_read(l.ix+e&65535))}),Q[164]=(()=>{Z(l.ix>>>8&255)}),Q[165]=(()=>{Z(255&l.ix)}),Q[166]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));Z(s.mem_read(l.ix+e&65535))}),Q[172]=(()=>{C(l.ix>>>8&255)}),Q[173]=(()=>{C(255&l.ix)}),Q[174]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));C(s.mem_read(l.ix+e&65535))}),Q[180]=(()=>{w(l.ix>>>8&255)}),Q[181]=(()=>{w(255&l.ix)}),Q[182]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));w(s.mem_read(l.ix+e&65535))}),Q[188]=(()=>{y(l.ix>>>8&255)}),Q[189]=(()=>{y(255&l.ix)}),Q[190]=(()=>{l.pc=l.pc+1&65535;const e=p(s.mem_read(l.pc));y(s.mem_read(l.ix+e&65535))}),Q[203]=(()=>{l.pc=l.pc+1&65535;const a=p(s.mem_read(l.pc));l.pc=l.pc+1&65535;const c=s.mem_read(l.pc);let m;if(c<64){m=(0,[B,D,E,F,G,I,J,K][(56&c)>>>3])(s.mem_read(l.ix+a&65535)),s.mem_write(l.ix+a&65535,m)}else{const e=(56&c)>>>3;c<128?(l.flags.N=0,l.flags.H=1,l.flags.Z=s.mem_read(l.ix+a&65535)&1<<e?0:1,l.flags.P=l.flags.Z,l.flags.S=7!==e||l.flags.Z?0:1):c<192?(m=s.mem_read(l.ix+a&65535)&~(1<<e)&255,s.mem_write(l.ix+a&65535,m)):(m=s.mem_read(l.ix+a&65535)|1<<e,s.mem_write(l.ix+a&65535,m))}void 0!==m&&(0==(7&c)?l.b=m:1==(7&c)?l.c=m:2==(7&c)?l.d=m:3==(7&c)?l.e=m:4==(7&c)?l.h=m:5==(7&c)?l.l=m:7==(7&c)&&(l.a=m)),l.cycle_counter+=e.cycle_counts_cb[c]+8}),Q[225]=(()=>{l.ix=i()}),Q[227]=(()=>{const e=l.ix;l.ix=s.mem_read(l.sp),l.ix|=s.mem_read(l.sp+1&65535)<<8,s.mem_write(l.sp,255&e),s.mem_write(l.sp+1&65535,e>>>8&255)}),Q[229]=(()=>{c(l,s,l.ix)}),Q[233]=(()=>{l.pc=l.ix-1&65535}),Q[249]=(()=>{l.sp=l.ix});const R=[];R[64]=(()=>{l.b=X(l.b<<8|l.c)}),R[65]=(()=>{s.io_write(l.b<<8|l.c,l.b)}),R[66]=(()=>{N(l.c|l.b<<8)}),R[67]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,s.mem_write(e,l.c),s.mem_write(e+1&65535,l.b)}),R[68]=(()=>Y),R[69]=(()=>{l.pc=i()-1&65535,l.iff1=l.iff2}),R[70]=(()=>{l.imode=0}),R[71]=(()=>{l.i=l.a}),R[72]=(()=>{l.c=X(l.b<<8|l.c)}),R[73]=(()=>{s.io_write(l.b<<8|l.c,l.c)}),R[74]=(()=>{H(l.c|l.b<<8)}),R[75]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,l.c=s.mem_read(e),l.b=s.mem_read(e+1&65535)}),R[76]=(()=>Y),R[77]=(()=>{l.pc=i()-1&65535}),R[78]=(()=>{l.imode=0}),R[79]=(()=>{l.r=l.a}),R[80]=(()=>{l.d=X(l.b<<8|l.c)}),R[81]=(()=>{s.io_write(l.b<<8|l.c,l.d)}),R[82]=(()=>{N(l.e|l.d<<8)}),R[83]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,s.mem_write(e,l.e),s.mem_write(e+1&65535,l.d)}),R[84]=(()=>Y),R[85]=(()=>{l.pc=i()-1&65535,l.iff1=l.iff2}),R[86]=(()=>{l.imode=1}),R[87]=(()=>{l.a=l.i,l.flags.S=128&l.i?1:0,l.flags.Z=l.i?0:1,l.flags.H=0,l.flags.P=l.iff2,l.flags.N=0}),R[88]=(()=>{l.e=X(l.b<<8|l.c)}),R[89]=(()=>{s.io_write(l.b<<8|l.c,l.e)}),R[90]=(()=>{H(l.e|l.d<<8)}),R[91]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,l.e=s.mem_read(e),l.d=s.mem_read(e+1&65535)}),R[92]=(()=>Y),R[93]=(()=>{l.pc=i()-1&65535,l.iff1=l.iff2}),R[94]=(()=>{l.imode=2}),R[95]=(()=>{l.a=l.r,l.flags.P=l.iff2}),R[96]=(()=>{l.h=X(l.b<<8|l.c)}),R[97]=(()=>{s.io_write(l.b<<8|l.c,l.h)}),R[98]=(()=>{N(l.l|l.h<<8)}),R[99]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,s.mem_write(e,l.l),s.mem_write(e+1&65535,l.h)}),R[100]=(()=>Y),R[101]=(()=>{l.pc=i()-1&65535,l.iff1=l.iff2}),R[102]=(()=>{l.imode=0}),R[103]=(()=>{let a=s.mem_read(l.l|l.h<<8);const c=15&a;a=(240&a)>>>4|(15&l.a)<<4,l.a=240&l.a|c,s.mem_write(l.l|l.h<<8,a),l.flags.S=128&l.a?1:0,l.flags.Z=l.a?0:1,l.flags.H=0,l.flags.P=e.parity_bits[l.a]?1:0,l.flags.N=0,r(l.a)}),R[104]=(()=>{l.l=X(l.b<<8|l.c)}),R[105]=(()=>{s.io_write(l.b<<8|l.c,l.l)}),R[106]=(()=>{H(l.l|l.h<<8)}),R[107]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,l.l=s.mem_read(e),l.h=s.mem_read(e+1&65535)}),R[108]=(()=>Y),R[109]=(()=>{l.pc=i()-1&65535,l.iff1=l.iff2}),R[110]=(()=>{l.imode=0}),R[111]=(()=>{let a=s.mem_read(l.l|l.h<<8);const c=240&a;a=(15&a)<<4|15&l.a,l.a=240&l.a|c>>>4,s.mem_write(l.l|l.h<<8,a),l.flags.S=128&l.a?1:0,l.flags.Z=l.a?0:1,l.flags.H=0,l.flags.P=e.parity_bits[l.a]?1:0,l.flags.N=0,r(l.a)}),R[112]=(()=>{X(l.b<<8|l.c)}),R[113]=(()=>{s.io_write(l.b<<8|l.c,0)}),R[114]=(()=>{N(l.sp)}),R[115]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,s.mem_write(e,255&l.sp),s.mem_write(e+1&65535,l.sp>>>8&255)}),R[116]=(()=>Y),R[117]=(()=>{l.pc=i()-1&65535,l.iff1=l.iff2}),R[118]=(()=>{l.imode=1}),R[120]=(()=>{l.a=X(l.b<<8|l.c)}),R[121]=(()=>{s.io_write(l.b<<8|l.c,l.a)}),R[122]=(()=>{H(l.sp)}),R[123]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,l.sp=s.mem_read(e),l.sp|=s.mem_read(e+1&65535)<<8}),R[124]=(()=>Y),R[125]=(()=>{l.pc=i()-1&65535,l.iff1=l.iff2}),R[126]=(()=>{l.imode=2}),R[160]=(()=>{v()}),R[161]=(()=>{j()}),R[162]=(()=>{q()}),R[163]=(()=>{z()}),R[168]=(()=>{M()}),R[169]=(()=>{O()}),R[170]=(()=>{k()}),R[171]=(()=>{A()}),R[176]=(()=>{v(),(l.b||l.c)&&(l.cycle_counter+=5,l.pc=l.pc-2&65535)}),R[177]=(()=>{j(),l.flags.Z||!l.b&&!l.c||(l.cycle_counter+=5,l.pc=l.pc-2&65535)}),R[178]=(()=>{q(),l.b&&(l.cycle_counter+=5,l.pc=l.pc-2&65535)}),R[179]=(()=>{z(),l.b&&(l.cycle_counter+=5,l.pc=l.pc-2&65535)}),R[184]=(()=>{M(),(l.b||l.c)&&(l.cycle_counter+=5,l.pc=l.pc-2&65535)}),R[185]=(()=>{O(),l.flags.Z||!l.b&&!l.c||(l.cycle_counter+=5,l.pc=l.pc-2&65535)}),R[186]=(()=>{k(),l.b&&(l.cycle_counter+=5,l.pc=l.pc-2&65535)}),R[187]=(()=>{A(),l.b&&(l.cycle_counter+=5,l.pc=l.pc-2&65535)});const T=[];T[0]=(()=>{}),T[1]=(()=>{l.pc=l.pc+1&65535,l.c=s.mem_read(l.pc),l.pc=l.pc+1&65535,l.b=s.mem_read(l.pc)}),T[2]=(()=>{s.mem_write(l.c|l.b<<8,l.a)}),T[3]=(()=>{let e=l.c|l.b<<8;e+=1,l.c=255&e,l.b=(65280&e)>>>8}),T[4]=(()=>{l.b=u(l.b)}),T[5]=(()=>{l.b=P(l.b)}),T[6]=(()=>{l.pc=l.pc+1&65535,l.b=s.mem_read(l.pc)}),T[7]=(()=>{const e=l.flags.S,a=l.flags.Z,c=l.flags.P;l.a=B(l.a),l.flags.S=e,l.flags.Z=a,l.flags.P=c}),T[8]=(()=>{let e=l.a;l.a=l.a_prime,l.a_prime=e,e=f(),a(l,(()=>l.flags_prime.S<<7|l.flags_prime.Z<<6|l.flags_prime.Y<<5|l.flags_prime.H<<4|l.flags_prime.X<<3|l.flags_prime.P<<2|l.flags_prime.N<<1|l.flags_prime.C)()),(e=>{l.flags_prime.S=(128&e)>>>7,l.flags_prime.Z=(64&e)>>>6,l.flags_prime.Y=(32&e)>>>5,l.flags_prime.H=(16&e)>>>4,l.flags_prime.X=(8&e)>>>3,l.flags_prime.P=(4&e)>>>2,l.flags_prime.N=(2&e)>>>1,l.flags_prime.C=1&e})(e)}),T[9]=(()=>{S(l.c|l.b<<8)}),T[10]=(()=>{l.a=s.mem_read(l.c|l.b<<8)}),T[11]=(()=>{let e=l.c|l.b<<8;e-=1,l.c=255&e,l.b=(65280&e)>>>8}),T[12]=(()=>{l.c=u(l.c)}),T[13]=(()=>{l.c=P(l.c)}),T[14]=(()=>{l.pc=l.pc+1&65535,l.c=s.mem_read(l.pc)}),T[15]=(()=>{const e=l.flags.S,a=l.flags.Z,c=l.flags.P;l.a=D(l.a),l.flags.S=e,l.flags.Z=a,l.flags.P=c}),T[16]=(()=>{l.b=l.b-1&255,g(0!==l.b)}),T[17]=(()=>{l.pc=l.pc+1&65535,l.e=s.mem_read(l.pc),l.pc=l.pc+1&65535,l.d=s.mem_read(l.pc)}),T[18]=(()=>{s.mem_write(l.e|l.d<<8,l.a)}),T[19]=(()=>{let e=l.e|l.d<<8;e+=1,l.e=255&e,l.d=(65280&e)>>>8}),T[20]=(()=>{l.d=u(l.d)}),T[21]=(()=>{l.d=P(l.d)}),T[22]=(()=>{l.pc=l.pc+1&65535,l.d=s.mem_read(l.pc)}),T[23]=(()=>{const e=l.flags.S,a=l.flags.Z,c=l.flags.P;l.a=E(l.a),l.flags.S=e,l.flags.Z=a,l.flags.P=c}),T[24]=(()=>{const e=p(s.mem_read(l.pc+1&65535));l.pc=l.pc+e+1&65535}),T[25]=(()=>{S(l.e|l.d<<8)}),T[26]=(()=>{l.a=s.mem_read(l.e|l.d<<8)}),T[27]=(()=>{let e=l.e|l.d<<8;e-=1,l.e=255&e,l.d=(65280&e)>>>8}),T[28]=(()=>{l.e=u(l.e)}),T[29]=(()=>{l.e=P(l.e)}),T[30]=(()=>{l.pc=l.pc+1&65535,l.e=s.mem_read(l.pc)}),T[31]=(()=>{const e=l.flags.S,a=l.flags.Z,c=l.flags.P;l.a=F(l.a),l.flags.S=e,l.flags.Z=a,l.flags.P=c}),T[32]=(()=>{g(!l.flags.Z)}),T[33]=(()=>{l.pc=l.pc+1&65535,l.l=s.mem_read(l.pc),l.pc=l.pc+1&65535,l.h=s.mem_read(l.pc)}),T[34]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,s.mem_write(e,l.l),s.mem_write(e+1&65535,l.h)}),T[35]=(()=>{let e=l.l|l.h<<8;e+=1,l.l=255&e,l.h=(65280&e)>>>8}),T[36]=(()=>{l.h=u(l.h)}),T[37]=(()=>{l.h=P(l.h)}),T[38]=(()=>{l.pc=l.pc+1&65535,l.h=s.mem_read(l.pc)}),T[39]=(()=>{let a=l.a;l.flags.N?((l.flags.H||(15&l.a)>9)&&(a-=6),(l.flags.C||l.a>153)&&(a-=96)):((l.flags.H||(15&l.a)>9)&&(a+=6),(l.flags.C||l.a>153)&&(a+=96)),l.flags.S=128&a?1:0,l.flags.Z=255&a?0:1,l.flags.H=16&l.a^16&a?1:0,l.flags.P=e.parity_bits[255&a],l.flags.C=l.flags.C||l.a>153?1:0,l.a=255&a,r(l.a)}),T[40]=(()=>{g(!!l.flags.Z)}),T[41]=(()=>{S(l.l|l.h<<8)}),T[42]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,l.l=s.mem_read(e),l.h=s.mem_read(e+1&65535)}),T[43]=(()=>{let e=l.l|l.h<<8;e-=1,l.l=255&e,l.h=(65280&e)>>>8}),T[44]=(()=>{l.l=u(l.l)}),T[45]=(()=>{l.l=P(l.l)}),T[46]=(()=>{l.pc=l.pc+1&65535,l.l=s.mem_read(l.pc)}),T[47]=(()=>{l.a=255&~l.a,l.flags.N=1,l.flags.H=1,r(l.a)}),T[48]=(()=>{g(!l.flags.C)}),T[49]=(()=>{l.sp=s.mem_read(l.pc+1&65535)|s.mem_read(l.pc+2&65535)<<8,l.pc=l.pc+2&65535}),T[50]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,s.mem_write(e,l.a)}),T[51]=(()=>{l.sp=l.sp+1&65535}),T[52]=(()=>{const e=l.l|l.h<<8;s.mem_write(e,u(s.mem_read(e)))}),T[53]=(()=>{const e=l.l|l.h<<8;s.mem_write(e,P(s.mem_read(e)))}),T[54]=(()=>{l.pc=l.pc+1&65535,s.mem_write(l.l|l.h<<8,s.mem_read(l.pc))}),T[55]=(()=>{l.flags.N=0,l.flags.H=0,l.flags.C=1,r(l.a)}),T[56]=(()=>{g(!!l.flags.C)}),T[57]=(()=>{S(l.sp)}),T[58]=(()=>{l.pc=l.pc+1&65535;let e=s.mem_read(l.pc);l.pc=l.pc+1&65535,e|=s.mem_read(l.pc)<<8,l.a=s.mem_read(e)}),T[59]=(()=>{l.sp=l.sp-1&65535}),T[60]=(()=>{l.a=u(l.a)}),T[61]=(()=>{l.a=P(l.a)}),T[62]=(()=>{l.a=s.mem_read(l.pc+1&65535),l.pc=l.pc+1&65535}),T[63]=(()=>{l.flags.N=0,l.flags.H=l.flags.C,l.flags.C=l.flags.C?0:1,r(l.a)}),T[192]=(()=>{d(!l.flags.Z)}),T[193]=(()=>{const e=i();l.c=255&e,l.b=(65280&e)>>>8}),T[194]=(()=>{_(!l.flags.Z)}),T[195]=(()=>{l.pc=s.mem_read(l.pc+1&65535)|s.mem_read(l.pc+2&65535)<<8,l.pc=l.pc-1&65535}),T[196]=(()=>{t(!l.flags.Z)}),T[197]=(()=>{c(l,s,l.c|l.b<<8)}),T[198]=(()=>{l.pc=l.pc+1&65535,x(s.mem_read(l.pc))}),T[199]=(()=>{o(0)}),T[200]=(()=>{d(!!l.flags.Z)}),T[201]=(()=>{l.pc=i()-1&65535}),T[202]=(()=>{_(!!l.flags.Z)}),T[203]=(()=>{l.r=128&l.r|1+(127&l.r)&127,l.pc=l.pc+1&65535;const a=s.mem_read(l.pc),c=(56&a)>>>3,m=7&a;if(a<64){const e=[B,D,E,F,G,I,J,K];0===m?l.b=e[c](l.b):1===m?l.c=e[c](l.c):2===m?l.d=e[c](l.d):3===m?l.e=e[c](l.e):4===m?l.h=e[c](l.h):5===m?l.l=e[c](l.l):6===m?s.mem_write(l.l|l.h<<8,e[c](s.mem_read(l.l|l.h<<8))):7===m&&(l.a=e[c](l.a))}else a<128?(0===m?l.flags.Z=l.b&1<<c?0:1:1===m?l.flags.Z=l.c&1<<c?0:1:2===m?l.flags.Z=l.d&1<<c?0:1:3===m?l.flags.Z=l.e&1<<c?0:1:4===m?l.flags.Z=l.h&1<<c?0:1:5===m?l.flags.Z=l.l&1<<c?0:1:6===m?l.flags.Z=s.mem_read(l.l|l.h<<8)&1<<c?0:1:7===m&&(l.flags.Z=l.a&1<<c?0:1),l.flags.N=0,l.flags.H=1,l.flags.P=l.flags.Z,l.flags.S=7!==c||l.flags.Z?0:1,l.flags.Y=5!==c||l.flags.Z?0:1,l.flags.X=3!==c||l.flags.Z?0:1):a<192?0===m?l.b&=255&~(1<<c):1===m?l.c&=255&~(1<<c):2===m?l.d&=255&~(1<<c):3===m?l.e&=255&~(1<<c):4===m?l.h&=255&~(1<<c):5===m?l.l&=255&~(1<<c):6===m?s.mem_write(l.l|l.h<<8,s.mem_read(l.l|l.h<<8)&~(1<<c)):7===m&&(l.a&=255&~(1<<c)):0===m?l.b|=1<<c:1===m?l.c|=1<<c:2===m?l.d|=1<<c:3===m?l.e|=1<<c:4===m?l.h|=1<<c:5===m?l.l|=1<<c:6===m?s.mem_write(l.l|l.h<<8,s.mem_read(l.l|l.h<<8)|1<<c):7===m&&(l.a|=1<<c);l.cycle_counter+=e.cycle_counts_cb[a]}),T[204]=(()=>{t(!!l.flags.Z)}),T[205]=(()=>{c(l,s,l.pc+3&65535),l.pc=s.mem_read(l.pc+1&65535)|s.mem_read(l.pc+2&65535)<<8,l.pc=l.pc-1&65535}),T[206]=(()=>{l.pc=l.pc+1&65535,n(s.mem_read(l.pc))}),T[207]=(()=>{o(8)}),T[208]=(()=>{d(!l.flags.C)}),T[209]=(()=>{const e=i();l.e=255&e,l.d=(65280&e)>>>8}),T[210]=(()=>{_(!l.flags.C)}),T[211]=(()=>{l.pc=l.pc+1&65535,s.io_write(l.a<<8|s.mem_read(l.pc),l.a)}),T[212]=(()=>{t(!l.flags.C)}),T[213]=(()=>{c(l,s,l.e|l.d<<8)}),T[214]=(()=>{l.pc=l.pc+1&65535,b(s.mem_read(l.pc))}),T[215]=(()=>{o(16)}),T[216]=(()=>{d(!!l.flags.C)}),T[217]=(()=>{let e=l.b;l.b=l.b_prime,l.b_prime=e,e=l.c,l.c=l.c_prime,l.c_prime=e,e=l.d,l.d=l.d_prime,l.d_prime=e,e=l.e,l.e=l.e_prime,l.e_prime=e,e=l.h,l.h=l.h_prime,l.h_prime=e,e=l.l,l.l=l.l_prime,l.l_prime=e}),T[218]=(()=>{_(!!l.flags.C)}),T[219]=(()=>{l.pc=l.pc+1&65535,l.a=s.io_read(l.a<<8|s.mem_read(l.pc))}),T[220]=(()=>{t(!!l.flags.C)}),T[221]=(()=>{l.r=128&l.r|1+(127&l.r)&127,l.pc=l.pc+1&65535;const a=s.mem_read(l.pc),c=Q[a];c?(c(),l.cycle_counter+=e.cycle_counts_dd[a]):(l.pc=l.pc-1&65535,l.cycle_counter+=e.cycle_counts[0])}),T[222]=(()=>{l.pc=l.pc+1&65535,h(s.mem_read(l.pc))}),T[223]=(()=>{o(24)}),T[224]=(()=>{d(!l.flags.P)}),T[225]=(()=>{const e=i();l.l=255&e,l.h=(65280&e)>>>8}),T[226]=(()=>{_(!l.flags.P)}),T[227]=(()=>{let e=s.mem_read(l.sp);s.mem_write(l.sp,l.l),l.l=e,e=s.mem_read(l.sp+1&65535),s.mem_write(l.sp+1&65535,l.h),l.h=e}),T[228]=(()=>{t(!l.flags.P)}),T[229]=(()=>{c(l,s,l.l|l.h<<8)}),T[230]=(()=>{l.pc=l.pc+1&65535,Z(s.mem_read(l.pc))}),T[231]=(()=>{o(32)}),T[232]=(()=>{d(!!l.flags.P)}),T[233]=(()=>{l.pc=l.l|l.h<<8,l.pc=l.pc-1&65535}),T[234]=(()=>{_(!!l.flags.P)}),T[235]=(()=>{let e=l.d;l.d=l.h,l.h=e,e=l.e,l.e=l.l,l.l=e}),T[236]=(()=>{t(!!l.flags.P)}),T[237]=(()=>{l.r=128&l.r|1+(127&l.r)&127,l.pc=l.pc+1&65535;const a=s.mem_read(l.pc),c=R[a];c?(c(),l.cycle_counter+=e.cycle_counts_ed[a]):l.cycle_counter+=e.cycle_counts[0]}),T[238]=(()=>{l.pc=l.pc+1&65535,C(s.mem_read(l.pc))}),T[239]=(()=>{o(40)}),T[240]=(()=>{d(!l.flags.S)}),T[241]=(()=>{const e=i();a(l,255&e),l.a=(65280&e)>>>8}),T[242]=(()=>{_(!l.flags.S)}),T[243]=(()=>{l.do_delayed_di=!0}),T[244]=(()=>{t(!l.flags.S)}),T[245]=(()=>{c(l,s,f()|l.a<<8)}),T[246]=(()=>{l.pc=l.pc+1&65535,w(s.mem_read(l.pc))}),T[247]=(()=>{o(48)}),T[248]=(()=>{d(!!l.flags.S)}),T[249]=(()=>{l.sp=l.l|l.h<<8}),T[250]=(()=>{_(!!l.flags.S)}),T[251]=(()=>{l.do_delayed_ei=!0}),T[252]=(()=>{t(!!l.flags.S)}),T[253]=(()=>{l.r=128&l.r|1+(127&l.r)&127,l.pc=l.pc+1&65535;const a=s.mem_read(l.pc),c=Q[a];if(c){const s=l.ix;l.ix=l.iy,c(),l.iy=l.ix,l.ix=s,l.cycle_counter+=e.cycle_counts_dd[a]}else l.pc=l.pc-1&65535,l.cycle_counter+=e.cycle_counts[0]}),T[254]=(()=>{l.pc=l.pc+1&65535,y(s.mem_read(l.pc))}),T[255]=(()=>{o(56)});const U=e=>0==(7&e)?l.b:1==(7&e)?l.c:2==(7&e)?l.d:3==(7&e)?l.e:4==(7&e)?l.h:5==(7&e)?l.l:6==(7&e)?s.mem_read(l.l|l.h<<8):l.a;if(118===m)l.halted=!0;else if(m>=64&&m<128){const e=U(m);(56&m)>>>3==0?l.b=e:(56&m)>>>3==1?l.c=e:(56&m)>>>3==2?l.d=e:(56&m)>>>3==3?l.e=e:(56&m)>>>3==4?l.h=e:(56&m)>>>3==5?l.l=e:(56&m)>>>3==6?s.mem_write(l.l|l.h<<8,e):(56&m)>>>3==7&&(l.a=e)}else if(m>=128&&m<192){const e=U(m);[x,n,b,h,Z,C,w,y][(56&m)>>>3](e)}else{(0,T[m])()}l.cycle_counter+=e.cycle_counts[m]};function s(){return{a:0,b:0,c:0,d:0,e:0,h:0,l:0,a_prime:0,b_prime:0,c_prime:0,d_prime:0,e_prime:0,h_prime:0,l_prime:0,ix:0,iy:0,i:0,r:0,sp:57328,pc:0,flags:{S:0,Z:0,Y:0,H:0,X:0,P:0,N:0,C:0},flags_prime:{S:0,Z:0,Y:0,H:0,X:0,P:0,N:0,C:0},imode:0,iff1:0,iff2:0,halted:!1,do_delayed_di:!1,do_delayed_ei:!1,cycle_counter:0}}const m=e=>{e.sp=57328,e.pc=0,e.a=0,e.r=0,a(e,0),e.imode=0,e.iff1=0,e.iff2=0,e.halted=!1,e.do_delayed_di=!1,e.do_delayed_ei=!1,e.cycle_counter=0};exports.reset=m;const p=(e,a)=>{if(!e.halted){let c=!1,s=!1;e.do_delayed_di?(e.do_delayed_di=!1,c=!0):e.do_delayed_ei&&(e.do_delayed_ei=!1,s=!0),e.r=128&e.r|1+(127&e.r)&127;const m=a.mem_read(e.pc);l(e,a,m),e.pc=e.pc+1&65535,c?(e.iff1=0,e.iff2=0):s&&(e.iff1=1,e.iff2=1);const p=e.cycle_counter;return e.cycle_counter=0,p}return 1};exports.execute=p;const f=(e,a,s,m)=>{if(s)e.r=128&e.r|1+(127&e.r)&127,e.halted=!1,e.iff2=e.iff1,e.iff1=0,c(e,a,e.pc),e.pc=102,e.cycle_counter+=11;else if(e.iff1)if(e.r=128&e.r|1+(127&e.r)&127,e.halted=!1,e.iff1=0,e.iff2=0,0===e.imode)l(e,a,m),e.cycle_counter+=2;else if(1===e.imode)c(e,a,e.pc),e.pc=56,e.cycle_counter+=13;else if(2===e.imode){c(e,a,e.pc);const l=e.i<<8|m;e.pc=a.mem_read(l)|a.mem_read(l+1&65535)<<8,e.cycle_counter+=19}};exports.interrupt=f;
},{"./z80-constants":"j7IA"}],"Elv6":[function(require,module,exports) {
"use strict";var t=r(require("nrf-intel-hex")),e=require("../util/tools"),o=require("./z80");function r(t){return t&&t.__esModule?t:{default:t}}const a=65536;let n=!1;const s=!0;let l=30,i=!0,f=0;const c=new Uint8Array(new ArrayBuffer(65536)).fill(255),d=Array(256).fill(255),u=Array(256).fill(255),y=Array(6).fill(0);let p=1,E=0;const _=(0,o.init)(),m=(0,e.throttle)(()=>{const e=new t.default,o=new Uint8Array(c);e.set(0,o);const r=e.asHexString();self.postMessage({type:"POST_ALL_MEMORY",memory:r})},5e3,!0),A=(0,e.throttle)(()=>{const t=new ArrayBuffer(6),e=new Uint8Array(t);for(let o=0;o<6;o++)e[o]=y[o];self.postMessage({type:"POST_DISPLAY",display:t},[t])},100);function g(t,e){const o=255&t;u[o]=e;const r=u[1],a=u[2];let n=1;for(let l=0;l<6;l++)r&n?y[l]=a:i||(y[l]=0),n<<=1;let s=!1;if(1===o){const t=e>>7;1===t&&0===p&&(E!==f&&(s=!0),E=f,f=0),p=t}f>1e4&&(0!==E&&(s=!0),E=0),s&&self.postMessage({type:"POST_WAVELENGTH",wavelength:E},[]),A()}const M={mem_read:t=>c[t],mem_write:(t,e)=>{const o=c[t];c[t]=e,o!==e&&m()},io_read:t=>d[255&t],io_write:g};function*S(){for(;;){for(let e=0;e<1e3;e++)try{const e=(0,o.execute)(_,M);f+=e}catch(t){const e=_.pc,r=c[e]||0;console.error(`Illegal operation at ${e.toString(16)}: ${r.toString(16)}`),(0,o.reset)(_)}yield f}}let T=!1;const w=S();function O(){if(!T&&n&&(w.next(),n)){T=!0;const t=Math.floor(30*(1-Number(l)));setTimeout(function(){T=!1,O()},t)}}const P=t=>{t&&(0,o.reset)(_),n=!0,O()},U=()=>{console.log("init")},h=()=>{P(!0)},v=t=>{const{port:e,value:o}=t.data;d[e]=o},I=t=>{const{code:e,pressed:o}=t.data;d[0]=e;d[3]=-65&d[3]|(o?0:64)},N=t=>{l=Number(t.data.value)/100},D=t=>{i=!0===t.data.value},L=()=>{(0,o.interrupt)(_,M,!0,0)},R=e=>{console.log("memory updated");const o=e.data.value,r=t.default.fromHex(o);for(const t of r.keys()){const e=r.get(t);for(let o=0;o<e.length;o++)c[o+t]=e[o]}P(!0)},Y=t=>{console.log("read memory");const e=t.data.from,o=t.data.size,r=new ArrayBuffer(o),a=new Uint8Array(r);for(let n=0;n<o;n++)a[n]=c[n+e];self.postMessage({type:"POST_MEMORY",from:e,size:o,buffer:r},[r])},x=t=>{t.data.value?n=!1:P(!1)};self.onmessage=(t=>{"INIT"===t.data.type?console.log("init"):"RESET"===t.data.type?P(!0):"SET_INPUT_VALUE"===t.data.type?v(t):"SET_KEY_VALUE"===t.data.type?I(t):"SET_SMOOTH"===t.data.type?D(t):"SET_SPEED"===t.data.type?N(t):"NMI"===t.data.type?(0,o.interrupt)(_,M,!0,0):"UPDATE_MEMORY"===t.data.type?R(t):"READ_MEMORY"===t.data.type?Y(t):"HIDDEN"===t.data.type&&x(t)});
},{"nrf-intel-hex":"PTIi","../util/tools":"hTHz","./z80":"jIr1"}]},{},["Elv6"], null)
//# sourceMappingURL=/wicked-tec1/worker.a5e8b082.js.map